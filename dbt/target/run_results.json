{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.3", "generated_at": "2026-01-29T02:37:41.002915Z", "invocation_id": "ecb72636-dda5-4d01-a583-5b5e36754d79", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T02:37:40.228957Z", "completed_at": "2026-01-29T02:37:40.237509Z"}, {"name": "execute", "started_at": "2026-01-29T02:37:40.238466Z", "completed_at": "2026-01-29T02:37:40.449341Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.22280311584472656, "adapter_response": {"_message": "SELECT 13", "code": "SELECT", "rows_affected": 13}, "message": "SELECT 13", "failures": null, "unique_id": "model.beanalytic_ida.dim_grupo_economico", "compiled": true, "compiled_code": "\n\nWITH grupo_norm AS (\n  SELECT DISTINCT\n    REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') AS nome_raw,\n    CASE \n      WHEN REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'OI%' THEN 'OI'\n      WHEN REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'CLARO%' THEN 'CLARO'\n      WHEN REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'VIVO%' OR REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'TELEF\u00d4NICA%' THEN 'VIVO'\n      WHEN REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'TIM%' THEN 'TIM'\n      WHEN REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'CTBC%' OR REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'ALGAR%' THEN 'ALGAR'\n      WHEN REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'SERCOMTEL%' THEN 'SERCOMTEL'\n      ELSE REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g')\n    END AS nome_final\n  FROM \"ida_datamart\".\"ida\".\"staging_ida\"\n)\nSELECT DISTINCT nome_final AS nome_grupo\nFROM grupo_norm", "relation_name": "\"ida_datamart\".\"ida\".\"dim_grupo_economico\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T02:37:40.458060Z", "completed_at": "2026-01-29T02:37:40.467037Z"}, {"name": "execute", "started_at": "2026-01-29T02:37:40.468100Z", "completed_at": "2026-01-29T02:37:40.649375Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.19424200057983398, "adapter_response": {"_message": "SELECT 1298", "code": "SELECT", "rows_affected": 1298}, "message": "SELECT 1298", "failures": null, "unique_id": "model.beanalytic_ida.fato_ida", "compiled": true, "compiled_code": "\n\nWITH refined AS (\n  SELECT \n    ano_mes,\n    UPPER(servico) AS svc,\n    CASE \n      WHEN REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'OI%' THEN 'OI'\n      WHEN REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'CLARO%' THEN 'CLARO'\n      WHEN REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'VIVO%' OR REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'TELEF\u00d4NICA%' THEN 'VIVO'\n      WHEN REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'TIM%' THEN 'TIM'\n      WHEN REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'CTBC%' OR REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'ALGAR%' THEN 'ALGAR'\n      WHEN REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g') LIKE 'SERCOMTEL%' THEN 'SERCOMTEL'\n      ELSE REGEXP_REPLACE(TRIM(REGEXP_REPLACE(UPPER(grupo_economico), '\\s*\\([^)]*\\)|\\*+', '', 'g')), '\\s+', ' ', 'g')\n    END AS grp,\n    MAX(CASE WHEN variavel ILIKE 'Indicador de Desempenho%' OR variavel ILIKE '\u00cdndice de Desempenho%' THEN valor END) AS val_ida,\n    MAX(CASE WHEN variavel ILIKE 'Taxa de Resolvidas em 5 dias%' THEN valor END) AS tx_5d,\n    MAX(CASE WHEN variavel ILIKE 'Taxa de Resolvidas no Per\u00edodo' THEN valor END) AS tx_tot,\n    MAX(CASE WHEN variavel IN ('Total de Solicita\u00e7\u00f5es', 'Quantidade de Solicita\u00e7\u00f5es', 'Quantidade de reclama\u00e7\u00f5es', 'Quantidade de Reclama\u00e7\u00f5es', 'Quantidade de Reclama\u00e7\u00f5es no Per\u00edodo', 'Total de Reclama\u00e7\u00f5es') THEN valor END) AS sol_tot,\n    MAX(CASE WHEN variavel IN ('Quantidade de resolvidas', 'Quantidade de Sol. Resolvidas no Per\u00edodo', 'Quantidade de Respondidas') THEN valor END) AS sol_res\n  FROM \"ida_datamart\".\"ida\".\"staging_ida\"\n  GROUP BY 1, 2, 3\n),\ncalc AS (\n  SELECT \n    *,\n    COALESCE(sol_res, ROUND((sol_tot * tx_tot / 100)))::integer AS res_final\n  FROM refined\n)\nSELECT \n  dt.id_tempo, dg.nome_grupo, ds.codigo_servico,\n  COALESCE(c.val_ida, c.tx_5d, 0) AS taxa_solicitacoes_resolvidas_5dias,\n  COALESCE(c.tx_tot, 0) AS taxa_solicitacoes_resolvidas,\n  COALESCE(c.sol_tot, 0) AS total_solicitacoes,\n  COALESCE(c.res_final, 0) AS solicitacoes_resolvidas\nFROM calc c\nJOIN \"ida_datamart\".\"ida\".\"dim_tempo\" dt ON c.ano_mes = dt.ano_mes\nJOIN \"ida_datamart\".\"ida\".\"dim_grupo_economico\" dg ON c.grp = dg.nome_grupo\nJOIN \"ida_datamart\".\"ida\".\"dim_servico\" ds ON c.svc = ds.codigo_servico", "relation_name": "\"ida_datamart\".\"ida\".\"fato_ida\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T02:37:40.657958Z", "completed_at": "2026-01-29T02:37:40.662623Z"}, {"name": "execute", "started_at": "2026-01-29T02:37:40.664151Z", "completed_at": "2026-01-29T02:37:40.796198Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.15002799034118652, "adapter_response": {"_message": "SELECT 1190", "code": "SELECT", "rows_affected": 1190}, "message": "SELECT 1190", "failures": null, "unique_id": "model.beanalytic_ida.long_delta", "compiled": true, "compiled_code": "\n\nWITH base AS (\n  SELECT\n    t.ano_mes,\n    f.id_tempo,\n    f.nome_grupo,\n    f.codigo_servico,\n    f.taxa_solicitacoes_resolvidas_5dias AS ida\n  FROM \"ida_datamart\".\"ida\".\"fato_ida\" f\n  JOIN \"ida_datamart\".\"ida\".\"dim_tempo\" t ON f.id_tempo = t.id_tempo\n),\nmercado AS (\n  SELECT\n    ano_mes,\n    AVG(ida) AS valor_mercado\n  FROM base\n  GROUP BY ano_mes\n),\nvariacoes AS (\n  SELECT\n    b.ano_mes,\n    b.nome_grupo,\n    -- Varia\u00e7\u00e3o do mercado (%): (atual - anterior) / anterior * 100\n    CASE\n      WHEN LAG(m.valor_mercado) OVER (ORDER BY b.ano_mes) > 0\n      THEN ((m.valor_mercado - LAG(m.valor_mercado) OVER (ORDER BY b.ano_mes))\n            / LAG(m.valor_mercado) OVER (ORDER BY b.ano_mes)) * 100\n    END AS var_mercado,\n    -- Varia\u00e7\u00e3o individual da operadora (%)\n    CASE\n      WHEN LAG(b.ida) OVER (PARTITION BY b.nome_grupo ORDER BY b.ano_mes) > 0\n      THEN ((b.ida - LAG(b.ida) OVER (PARTITION BY b.nome_grupo ORDER BY b.ano_mes))\n            / LAG(b.ida) OVER (PARTITION BY b.nome_grupo ORDER BY b.ano_mes)) * 100\n    END AS var_individual\n  FROM base b\n  JOIN mercado m USING (ano_mes)\n)\nSELECT\n  ano_mes,\n  nome_grupo,\n  ROUND(var_mercado::numeric, 2) AS var_mercado,\n  ROUND(var_individual::numeric, 2) AS var_individual,\n  ROUND((var_mercado - var_individual)::numeric, 2) AS diferenca\nFROM variacoes\nWHERE var_mercado IS NOT NULL\n  AND var_individual IS NOT NULL", "relation_name": "\"ida_datamart\".\"ida\".\"long_delta\""}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-29T02:37:40.827246Z", "completed_at": "2026-01-29T02:37:40.873698Z"}, {"name": "execute", "started_at": "2026-01-29T02:37:40.874830Z", "completed_at": "2026-01-29T02:37:40.978119Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.15708565711975098, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.beanalytic_ida.pivot_variacao", "compiled": true, "compiled_code": "\n\n\n\n  \n\n\nselect\n  ano_mes as \"Mes\",\n  coalesce(round(avg(var_mercado)::numeric, 1), 0) as \"Taxa de Varia\u00e7\u00e3o M\u00e9dia\"\n  \n  , coalesce(round(max(case when nome_grupo = 'VIVO' then diferenca end)::numeric, 1), 0) as \"VIVO\"\n  \n  , coalesce(round(max(case when nome_grupo = 'OI' then diferenca end)::numeric, 1), 0) as \"OI\"\n  \n  , coalesce(round(max(case when nome_grupo = 'NET' then diferenca end)::numeric, 1), 0) as \"NET\"\n  \n  , coalesce(round(max(case when nome_grupo = 'NEXTEL' then diferenca end)::numeric, 1), 0) as \"NEXTEL\"\n  \n  , coalesce(round(max(case when nome_grupo = 'CLARO' then diferenca end)::numeric, 1), 0) as \"CLARO\"\n  \n  , coalesce(round(max(case when nome_grupo = 'VIACABO' then diferenca end)::numeric, 1), 0) as \"VIACABO\"\n  \n  , coalesce(round(max(case when nome_grupo = 'SERCOMTEL' then diferenca end)::numeric, 1), 0) as \"SERCOMTEL\"\n  \n  , coalesce(round(max(case when nome_grupo = 'TIM' then diferenca end)::numeric, 1), 0) as \"TIM\"\n  \n  , coalesce(round(max(case when nome_grupo = 'EMBRATEL' then diferenca end)::numeric, 1), 0) as \"EMBRATEL\"\n  \n  , coalesce(round(max(case when nome_grupo = 'SKY' then diferenca end)::numeric, 1), 0) as \"SKY\"\n  \n  , coalesce(round(max(case when nome_grupo = 'ALGAR' then diferenca end)::numeric, 1), 0) as \"ALGAR\"\n  \n  , coalesce(round(max(case when nome_grupo = 'GVT' then diferenca end)::numeric, 1), 0) as \"GVT\"\n  \n  , coalesce(round(max(case when nome_grupo = 'INTELIG' then diferenca end)::numeric, 1), 0) as \"INTELIG\"\n  \nfrom \"ida_datamart\".\"ida\".\"long_delta\"\ngroup by 1\norder by \"Mes\"", "relation_name": "\"ida_datamart\".\"ida\".\"pivot_variacao\""}], "elapsed_time": 0.8929886817932129, "args": {"partial_parse": true, "defer": false, "log_path": "/opt/dbt/logs", "printer_width": 80, "select": ["dim_grupo_economico", "fato_ida", "long_delta", "pivot_variacao"], "send_anonymous_usage_stats": true, "invocation_command": "dbt run --select dim_grupo_economico fato_ida long_delta pivot_variacao", "use_colors": true, "enable_legacy_logger": false, "macro_debugging": false, "static_parser": true, "vars": {}, "version_check": true, "partial_parse_file_diff": true, "introspect": true, "cache_selected_only": false, "log_level_file": "debug", "quiet": false, "populate_cache": true, "use_colors_file": true, "warn_error_options": {"include": [], "exclude": []}, "indirect_selection": "eager", "profiles_dir": "/opt/dbt", "exclude": [], "log_format": "default", "log_level": "info", "write_json": true, "print": true, "which": "run", "project_dir": "/opt/dbt", "strict_mode": false, "log_format_file": "debug", "log_file_max_bytes": 10485760, "favor_state": false, "show_resource_report": false}}